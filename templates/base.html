<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="https://fonts.googleapis.com/css2?family=Bevan&family=Oxygen:wght@300&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" href="{{url_for('static', filename='css/style.css') }}" type="text/css">
    <title>RecoMedia</title>
</head>

<body>
<nav>
    <div class="nav-wrapper">
      <a href="#!" class="brand-logo center">
        <h1>RecoMedia</h1>
      </a>
      <ul class="right hide-on-med-and-down">
    {% if 'username' in session %}
        <li id="login-status">Logged in as {{session['username']}}</li>
    {% endif %}
        <li><a href="{{url_for('home')}}">Home</a></li>
        <li><a id="dropdown-users" class='dropdown-trigger' href='' data-target='dropdown'>Users</a>
            <ul id='dropdown' class='dropdown-content'>
                <li id="search-bar-container">
                    <form action="{{url_for('view_user' ) }}" method="POST">
                        <input type="text" name="username" placeholder="Look up user" id="user-search" onkeyup="filterUsers(this)">
                        <button id="user-search-btn" type="submit"><img src="{{url_for('static', filename='images/search-icon.png') }}" alt="Search-icon"></button>
                    </form>
                </li>
                <li id="suggestion-description">User profiles matching your search</li>
            </ul>
        </li>
        {% if 'username' in session %}
        <li><a href="{{ url_for('logout') }}">Log out</a></li>
        {% else %}
        <li><a href="{{ url_for('login_page') }}">Login</a></li>
        {% endif %}
        <li class="active"><a href="{{url_for('show_films')}}">Films</a></li>
      </ul>
    </div>
</nav>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>

    {% block content %}
    {% endblock %}
    <script>
    $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
     $(document).ready(function(){
        $(".dropdown-trigger").dropdown({
            coverTrigger: false,
            closeOnClick: false
        });
     });
     
     function filterUsers(userSearch){
        userEntry=$(userSearch).val();
        console.log(userEntry)
        $.getJSON($SCRIPT_ROOT + '/username_search_options', 
            { searchValue: userEntry },
            function(data) {
                $("#suggestion-description").html("User profiles matching your search");
                let r = data.result;
                r=JSON.parse(r);
                if(r.length==0){
                    $("#suggestion-description").html("No users available from this search")
                }
                $(".suggestions").remove();
                for(i of r){
                    $("#dropdown").append(`<li class="suggestions" onclick="getSuggestion(this)">`+i['username']+`</li>`);
                }
            }); 
     }

     function getSuggestion(suggestion){
         // Upon clicking suggestion (dynamically created in filterUsers function) suggestion appears 
         // in input field.
         s=$(suggestion).text();
         $('#user-search').val(s);
     }
    </script>
</body>
</html>