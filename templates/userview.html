{% extends 'base.html' %}
{% block content %}

{% with messages = get_flashed_messages(with_categories=true) %}
	{% if messages %}
	<ul class=flashes>
        <div class='err-msg-container'>
            {% for category, message in messages %}
            <div class="{{category}}">{{ message }}</div>
            {% endfor %}
        </div>
	</ul>
{% endif %}
{% endwith %}

{% if films %}
<h2 id="user-title">{{username}}'s Films</h2>

{% set film_count = films|length %}
{% if film_count > 0 %}

<p>{{username}} has rated {{ film_count }} films</p>

<div class="carousel-container">
	<div class="prev hide-on-med-and-down">
		<</div> <div class="carousel carousel-slider center" data-indicators="false">
			{% for film in films %}
			<div class="carousel-item center">
				<div class="arrow-pic-container">
					<div class="prev hide-on-large-and-up">
						<</div> <div class="poster-container">
							<img src="{{film.poster}}" alt="{{film.title}} (poster unavailable)">
                    {% for rate in film.ratings %}
                    {% if rate.username==username %}
							<div class="rating-overlay">
								<div class="rating-container">
									{{rate.rating}}
								</div>
							</div>
					</div>
					<div class="next hide-on-large-and-up">></div>
				</div>
				<div class="table-container">
					<table>
						<tr>
							<td class="left-field ">Year:</td>
							<td class="right-field">{{film.year}}</td>
						</tr>
						<tr>
							<td class="left-field ">Cast:</td>
							<td class="right-field">{{film.cast}}</td>
						</tr>
						<tr>
							<td class="left-field">Director:</td>
							<td class="right-field">{{film.director}}</td>
						</tr>
						<tr>
							<td class="left-field">Runtime:</td>
							<td class="right-field">{{film.runtime}}</td>
						</tr>
						<tr>
							<td class="left-field">Review:</td>
							<td class="right-field">{{rate.review}}</td>
						</tr>
					</table>
                    {% endif %}
                    {% endfor %}
				</div>
			</div>
			{% endfor %}
	</div>
	<div class="next hide-on-med-and-down">></div>
</div>

<h3>{{username}}'s' Top Picks</h3>

<ul class="pagination top-picks">
    <li class="disabled left-chev" onclick="prevPage(this)"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
    {% for page in range(top_picks|count) %}
    {% if page +1==1 %}
    <li class="page-btn active" id="tp-page-btn{{page+1}}" onclick="goToPage(this)">
    {% else %}
    <li id="tp-page-btn{{page+1}}" class="page-btn" onclick="goToPage(this)">
    {% endif %}
    <a href="#tp-page-{{page+1}}">{{page+1}}</a></li>
    {% endfor %}
    <li class="waves-effect right-chev" onclick="nextPage(this)"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
</ul>

{% set pages_counted = [] %}
{% for page in top_picks %}
<div id="tp-page-{{loop.index}}" class="film-card-container top-picks">
<div class="table">
{% for film in page %}
    <a class="table-row film-card" href="{{ url_for('get_reviews', filmID=film.imdbID, avgRating=film.averageRating) }}">
        <div class="table-cell rank">{{ loop.index + (pages_counted|length*films_per_page) }}</div>
        <div class="table-cell title">{{film.title}}</div>
        <div class="table-cell year">{{film.year}}</div>
        <div class="table-cell rating">{{film.ratings.0.rating}}</div>    
    </a>
{% endfor %}
</div>
</div>
{% set __ = pages_counted.append(1) %}
{% endfor %}

<h3>{{username}}'s' New Release Recommendations</h3>  

<ul class="pagination new-releases">
    <li class="disabled left-chev" onclick="prevPage(this)"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
    {% for page in range(new_releases|count) %}
    {% if page +1==1 %}
    <li id="nr-page-btn{{page+1}}" class="active page-btn" onclick="goToPage(this)">
    {% else %}
    <li id="nr-page-btn{{page+1}}" class="page-btn" onclick="goToPage(this)">
    {% endif %}
    <a href="#nr-page-{{page+1}}.new-releases">{{page+1}}</a></li>
    {% endfor %}
    <li class="waves-effect right-chev" onclick="nextPage(this)"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
</ul>

{% set nr_pages_counted = [] %}
{% for page in new_releases %}
<div id="nr-page-{{loop.index}}" class="film-card-container new-releases">
<div class="table">
{% for film in page %}
    <a class="table-row film-card" href="{{ url_for('get_reviews', filmID=film.imdbID, avgRating=film.averageRating) }}">
        <div class="table-cell rank">{{ loop.index + (nr_pages_counted|length*films_per_page) }}</div>
        <div class="table-cell title">{{film.title}}</div>
        <div class="table-cell year">{{film.year}}</div>
        <div class="table-cell rating">{{film.ratings.0.rating}}</div>    
    </a>
{% endfor %}
</div>
</div>
{% set __ = nr_pages_counted.append(1) %}
{% endfor %}    

<h3>View {{username}}'s films by Genre</h3>

<div class="category-grid-container">
    <div class="box-grid">
        <div id="Animation" class="box-item genre-item" onclick="getUserGenre(this)">Animation</div>
        <div id="Action" class="box-item genre-item" onclick="getUserGenre(this)">Action</div>
        <div id="Sci-fi" class="box-item genre-item" onclick="getUserGenre(this)">Sci-fi</div>
        <div id="Comedy" class="box-item genre-item" onclick="getUserGenre(this)">Comedy</div>
        <div id="Crime" class="box-item genre-item" onclick="getUserGenre(this)">Crime</div>
        <div id="Thriller" class="box-item genre-item" onclick="getUserGenre(this)">Thriller</div>
        <div id="Romance" class="box-item genre-item" onclick="getUserGenre(this)">Romance</div>
        <div id="Horror" class="box-item genre-item" onclick="getUserGenre(this)">Horror</div>
        <div id="Fantasy" class="box-item genre-item" onclick="getUserGenre(this)">Fantasy</div>
    </div>
</div>

<div id="genre-results-area"></div>

{% else %}
<p>{{username}} doesn't currently have any film reviews.</p>
{% endif %}
{% endif %}

<script language='javascript' type='text/javascript'>
</script>

{% endblock %}